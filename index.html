<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Talevia Game - Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #111 50%, #FF9740 100%);
      color: #222;
      margin: 0;
      padding: 0;
      min-height: 100vh;
      direction: rtl;
    }
    header {
      background: linear-gradient(90deg, #FF9740 0%, #1a1a1a 80%);
      color: #fff;
      padding: 16px 8px 8px 8px;
      text-align: center;
      border-bottom: 4px solid #ff9740;
      position: relative;
    }
    .logo {
      max-width: 88px;
      border-radius: 18px;
      margin-bottom: 7px;
      box-shadow: 0 4px 22px rgba(255, 151, 64, 0.22);
      transition: all 0.4s;
      background: #fff;
    }
    h1, h2, h3 { color: #FF9740; }
    h1 { margin-top: 10px;}
    main {
      max-width: 540px;
      margin: 18px auto;
      background: #fff;
      border-radius: 18px;
      box-shadow: 0 8px 32px rgba(255, 151, 64, 0.10);
      padding: 25px 15px 35px 15px;
      min-height: 650px;
      position: relative;
    }
    .flex-center { display: flex; justify-content: center; align-items: center; }
    .rounded { border-radius: 12px; }
    .btn {
      background: linear-gradient(90deg,#FF9740 30%,#FFA54E 100%);
      color: #fff;
      border: none;
      border-radius: 10px;
      padding: 11px 22px;
      margin: 9px 4px;
      font-weight: bold;
      font-size: 1.03em;
      letter-spacing: 1px;
      box-shadow: 0 2px 12px rgba(255,151,64,.18);
      cursor: pointer;
      transition: background 0.2s,transform 0.15s;
      text-align:center;
      min-width: 90px;
    }
    .btn:hover { background: #353535; color: #FF9740; transform: scale(1.034);}
    .input-block { margin: 14px 0; }
    input, select {
      border: 2px solid #ff9740;
      background: #f0f5ff;
      border-radius: 10px;
      padding: 11px;
      font-size: 1em;
      color: #111;
      width: 96%; max-width: 340px;
      margin-top: 4px;
      margin-bottom: 11px;
      outline: none;
      transition: border 0.3s;
    }
    input:focus {border: 2px solid #1567de;}
    .stars-count, .points-count {
      background: #111;
      color: #FFD700;
      padding: 9px 11px;
      border-radius: 12px;
      display: inline-block;
      font-size: 1.07em;
      margin: 13px 10px 5px 10px;
      letter-spacing: 1.3px;
      text-shadow: 0 2px 9px rgba(255, 215, 0, .30);
    }
    .bar-bg {
      width: 100%; height: 24px; background: #eee;
      border-radius: 12px; margin: 15px auto 13px auto;
      box-shadow: 0 1px 6px rgba(21,103,222,0.06);
      overflow: hidden;
      position: relative;
    }
    .bar-fill {
      background: linear-gradient(90deg, #ff9740 10%, #51bbf6 90%);
      height: 100%; min-width:24px;
      color: #fff; font-weight: bold;
      border-radius: 12px;
      transition: width 0.6s;
      text-align: center;
      font-size: 1em;
      line-height:24px;
      box-shadow:0 0 11px #FFD70055;
    }
    .activity-list { margin: 27px 0 11px 0; display: flex; flex-wrap: wrap; gap:16px; justify-content: space-around;}
    .activity-card {
      flex:1 1 135px; min-width:130px; background:#FEF4EC; border:2px solid #FF9740;
      border-radius:12px; margin:7px; padding:13px 7px; text-align:center; cursor:pointer;
      transition: box-shadow 0.35s, transform 0.30s;
      font-size:1.1em; position: relative;
      min-height:85px;
    }
    .activity-card:hover {
      box-shadow: 0 4px 20px #ff974022;
      background: #FFF8F1;
      transform: translateY(-2.5px) scale(1.04);
    }
    .emoji { font-size: 2.3em; display:block;margin-bottom:7px;}
    .msg { color: #e74c3c; font-weight: bold; margin: 6px 0;}
    .msg.ok { color: #10ad67;}
    .back-btn {background:#fff;color:#111; border:1.5px solid #ff9740;}
    .back-btn:hover{background:#FF9740;color:#fff;}
    .hidden{display:none !important;}
    /* Bot */
    .bot-area { margin: 15px auto 9px auto; text-align: center; }
    .bot { background:#222; width:81px; height:81px; border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 22px #1567de26,0 0 18px #FF974044;animation: botFloat 2.4s infinite;}
    @keyframes botFloat {
      0%,100%{transform: translateY(0);}
      50%{transform: translateY(-14px);}
    }
    .bot-face { font-size: 2.5em; user-select:none; color:#51bbf6;}
    .bot-text { color:#1a1a1a;background:#FFEBCD; padding:6px 11px; border-radius:13px;
      font-size:1.11em; margin:10px auto; display:inline-block; min-width:80px;}
    .bot-speaker {display:inline-block;margin-right:7px; color:#51bbf6;cursor:pointer;}
    .mood-select .emoji, .mood-note {margin:9px 0;}
    .mood-note {width:80%;min-height:43px;}
    .cup-row {margin:13px 0;text-align:center;}
    .cup {width:41px;height:54px;background:#c6e6fb;border:2px solid #51bbf6;display:inline-block;margin:5px;border-radius:11px;cursor:pointer;transition:.3s;position:relative;}
    .cup.filled{background:linear-gradient(180deg,#51bbf6 65%,#1567de 100%);}
    /* Responsive */
    @media(max-width:620px){main{min-width:97vw!important;max-width:99vw!important;padding:8px 0px;}}
    @media(max-width:400px){.btn{font-size:.97em;padding:8px 7px;min-width:70px;}}
  </style>
</head>
<body>
  <header>
    <span style="display:inline-block;">
      <img src="1000365989.jpeg" class="logo" alt="Talevia Logo"
      onerror="this.style.display='none'" />
    </span>
    <h1>Talevia Game</h1>
  </header>
  <main>
    <!-- Login/Register -->
    <div id="auth-section">
      <h2>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ / Ø­Ø³Ø§Ø¨ Ø¬Ø¯ÙŠØ¯</h2>
      <div class="input-block">
        <label>Ù†ÙˆØ¹ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</label>
        <select id="acc-type">
          <option value="child">Ø·ÙÙ„</option>
          <option value="parent">ÙˆÙ„ÙŠ Ø£Ù…Ø±</option>
          <option value="admin">Ù…Ø¯ÙŠØ±</option>
        </select>
      </div>
      <div class="input-block" id="acc-block-child">
        <label>Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„:</label>
        <input type="text" id="child-name" maxlength="15" placeholder="Ù…Ø«Ø§Ù„: ÙŠØ§Ø³ÙŠÙ†"/>
        <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label>
        <input type="email" id="child-email" placeholder="example@email.com" />
        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±:</label>
        <input type="password" id="child-pass" />
      </div>
      <div class="input-block hidden" id="acc-block-parent">
        <label>Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:</label>
        <input type="text" id="parent-name" maxlength="17" placeholder="Ù…Ø«Ø§Ù„: Ø£Ø¨ Ù…Ø­Ù…Ø¯"/>
        <label>Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±:</label>
        <input type="email" id="parent-email" />
        <label>Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø·ÙÙ„:</label>
        <input type="email" id="parent-child-email" placeholder="Ø¥ÙŠÙ…ÙŠÙ„ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·" />
        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ±:</label>
        <input type="password" id="parent-pass" />
      </div>
      <div class="input-block hidden" id="acc-block-admin">
        <label>ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø§Ù„Ù…Ø¯ÙŠØ±:</label>
        <input type="password" id="admin-pass" />
      </div>
      <div>
        <button class="btn" id="login-btn">Ø¯Ø®ÙˆÙ„</button>
        <button class="btn" id="reg-btn">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <div class="msg" id="auth-msg"></div>
      <div class="msg ok hidden" id="pending-msg">ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ± Ø¹Ù„Ù‰ Ø§Ù„Ø­Ø³Ø§Ø¨!</div>
    </div>
    <!-- Main Game Section -->
    <div id="game-section" class="hidden">
      <div class="bot-area">
        <div class="bot"><span class="bot-face" id="bot-face">ğŸ¤–</span></div>
        <div class="bot-text" id="bot-msg">
          Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! Ø£Ù†Ø§ Talevia Bot.<span class="bot-speaker" title="ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª" onclick="speakBot()">ğŸ”Š</span>
        </div>
      </div>
      <div style="text-align:center;">
        <span class="stars-count">â­ Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="stat-stars">0</span></span>
        <span class="points-count">ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="stat-points">0</span></span>
        <div class="bar-bg">
          <div class="bar-fill" id="progress-bar" style="width:0%">0%</div>
        </div>
      </div>
      <div style="text-align:center;margin:10px 0;">
        <input type="file" id="pic-upload" accept="image/*" style="display:none;">
        <button class="btn" onclick="document.getElementById('pic-upload').click();">ğŸ“· ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</button>
        <img id="user-pic" class="rounded" src="" style="max-width:80px;display:none;margin-top:5px;" alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„" />
      </div>
      <h3 style="text-align:center;">Ø§Ø®ØªØ± Ù†Ø´Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
      <div class="activity-list">
        <div class="activity-card" onclick="openAct('food')"><span class="emoji">ğŸ¥—</span>Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ</div>
        <div class="activity-card" onclick="openAct('water')"><span class="emoji">ğŸ’§</span>Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡</div>
        <div class="activity-card" onclick="openAct('exercise')"><span class="emoji">ğŸƒ</span>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ</div>
        <div class="activity-card" onclick="openAct('mood')"><span class="emoji">ğŸ˜Š</span>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</div>
        <div class="activity-card" onclick="openAct('sleep')"><span class="emoji">ğŸŒ™</span>Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ</div>
      </div>
      <div style="text-align:center;">
        <button class="btn back-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
      </div>
    </div>
    <!-- Activities -->
    <!-- 1. Food Activity -->
    <div id="food-section" class="hidden">
      <h2>ğŸ¥— Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ - Talevia Game</h2>
      <div><b>Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬Ø¨Ø©:</b></div>
      <div class="activity-list" style="flex-wrap:nowrap;">
        <div class="activity-card" onclick="openMeal('breakfast')"><span class="emoji">ğŸŒ…</span>Ø§Ù„ÙØ·ÙˆØ±</div>
        <div class="activity-card" onclick="openMeal('lunch')"><span class="emoji">â˜€ï¸</span>Ø§Ù„ØºØ¯Ø§Ø¡</div>
        <div class="activity-card" onclick="openMeal('dinner')"><span class="emoji">ğŸŒ™</span>Ø§Ù„Ø¹Ø´Ø§Ø¡</div>
      </div>
      <div id="meal-content"></div>
      <button class="btn back-btn" onclick="closeAct('food')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      <div class="msg" id="food-msg"></div>
    </div>
    <!-- 2. Water Activity -->
    <div id="water-section" class="hidden">
      <h2>ğŸ’§ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ - Talevia Game</h2>
      <div class="cup-row" id="cup-row"></div>
      <div style="text-align:center;margin:6px;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¨ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <span id="cup-count">0</span>/8</div>
      <button class="btn back-btn" onclick="closeAct('water')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      <div class="msg" id="water-msg"></div>
    </div>
    <!-- 3. Exercise Activity -->
    <div id="exercise-section" class="hidden">
      <h2>ğŸƒ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ - Talevia Game</h2>
      <div class="activity-list">
        <div class="activity-card" onclick="openExercise('running')"><span class="emoji">ğŸƒâ€â™‚ï¸</span>Ø§Ù„Ø¬Ø±ÙŠ</div>
        <div class="activity-card" onclick="openExercise('swimming')"><span class="emoji">ğŸŠâ€â™‚ï¸</span>Ø§Ù„Ø³Ø¨Ø§Ø­Ø©</div>
        <div class="activity-card" onclick="openExercise('yoga')"><span class="emoji">ğŸ§˜</span>ÙŠÙˆØ¬Ø§</div>
        <div class="activity-card" onclick="openExercise('cycling')"><span class="emoji">ğŸš´</span>Ø¯Ø±Ø§Ø¬Ø©</div>
      </div>
      <div id="exercise-content"></div>
      <button class="btn back-btn" onclick="closeAct('exercise')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      <div class="msg" id="exercise-msg"></div>
    </div>
    <!-- 4. Mood Activity -->
    <div id="mood-section" class="hidden">
      <h2>ğŸ˜Š Ø§Ù„Ù…Ø´Ø§Ø¹Ø± - Talevia Game</h2>
      <div class="mood-select flex-center">
        <span class="emoji" onclick="selectMood('Ø³Ø¹ÙŠØ¯')">ğŸ˜Š</span>
        <span class="emoji" onclick="selectMood('Ø­Ø²ÙŠÙ†')">ğŸ˜¢</span>
        <span class="emoji" onclick="selectMood('ØºØ§Ø¶Ø¨')">ğŸ˜ </span>
        <span class="emoji" onclick="selectMood('Ù…ØªØ­Ù…Ø³')">ğŸ¤©</span>
        <span class="emoji" onclick="selectMood('Ù…ØªØ¹Ø¨')">ğŸ˜´</span>
        <span class="emoji" onclick="selectMood('Ù…Ø­Ø¨')">ğŸ˜</span>
      </div>
      <textarea class="mood-note" id="mood-note" placeholder="ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ…ÙƒØŸ"></textarea>
      <button class="btn" onclick="saveMood()">ğŸ’¾ Ø­ÙØ¸</button>
      <button class="btn back-btn" onclick="closeAct('mood')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      <div class="msg" id="mood-msg"></div>
    </div>
    <!-- 5. Sleep Activity -->
    <div id="sleep-section" class="hidden">
      <h2>ğŸŒ™ Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ - Talevia Game</h2>
      <div class="input-block">
        <label>â° Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ù†ÙˆÙ…Ùƒ Ø§Ù„Ù„ÙŠÙ„Ø©:</label>
        <input type="number" min="0" max="12" id="sleep-hours" style="width:90px;text-align:center;" />
        <button class="btn" onclick="saveSleep()">ğŸ’¾ Ø­ÙØ¸</button>
      </div>
      <div style="margin:16px 0; background:#FEF4EC;padding:12px;border-radius:10px;">
        <b>âœ¨ ØªØ£ÙƒÙŠØ¯Ø§Øª Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©:</b>
        <div id="affirmation" style="font-size:1.14em;color:#51bbf6;margin:8px 0;"></div>
        <button class="btn" onclick="newAffirmation()">ğŸ”„ ØªØ£ÙƒÙŠØ¯ Ø¬Ø¯ÙŠØ¯</button>
      </div>
      <button class="btn back-btn" onclick="closeAct('sleep')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
      <div class="msg" id="sleep-msg"></div>
    </div>
  </main>
  <script>
    // Ù‚ÙˆØ§Ø¹Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ®Ø²ÙŠÙ†ÙŠØ©
    const progressKey = "talevia-progress";
    const usersKey = "talevia-users";
    const sessionKey = "talevia-session";
    const avatarKey = "talevia-avatar";
    const adminPass = "talevia@0800";

    // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„Ø®ÙŠØ§Ø±Ø§Øª
    const foods = {
      breakfast: [
        { name: "Ø¨ÙŠØ¶ Ù…Ø³Ù„ÙˆÙ‚", emoji: "ğŸ¥š" },
        { name: "Ø´ÙˆÙØ§Ù† Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡", emoji: "ğŸ¥£" },
        { name: "ØªÙˆØ³Øª Ø¨Ø§Ù„Ø£ÙÙˆÙƒØ§Ø¯Ùˆ", emoji: "ğŸ¥‘" },
        { name: "Ø²Ø¨Ø§Ø¯ÙŠ Ø¨Ø§Ù„Ø¹Ø³Ù„", emoji: "ğŸ¯" },
        { name: "ÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø©", emoji: "ğŸ" }
      ],
      lunch: [
        { name: "Ø³Ù„Ø·Ø© Ø®Ø¶Ø±Ø§Ø¡", emoji: "ğŸ¥—" },
        { name: "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", emoji: "ğŸ—" },
        { name: "Ø£Ø±Ø² Ø¨Ù†ÙŠ", emoji: "ğŸš" },
        { name: "Ø³Ù…Ùƒ Ù…Ø´ÙˆÙŠ", emoji: "ğŸŸ" },
        { name: "Ø®Ø¶Ø§Ø± Ù…Ø·Ø¨ÙˆØ®Ø©", emoji: "ğŸ¥¦" }
      ],
      dinner: [
        { name: "Ø´ÙˆØ±Ø¨Ø© Ø®Ø¶Ø§Ø±", emoji: "ğŸ²" },
        { name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ØµØ­ÙŠ", emoji: "ğŸ¥ª" },
        { name: "Ù…Ø¹ÙƒØ±ÙˆÙ†Ø© Ø¨Ø§Ù„Ø®Ø¶Ø§Ø±", emoji: "ğŸ" },
        { name: "Ø³Ù„Ø·Ø© ÙÙˆØ§ÙƒÙ‡", emoji: "ğŸ¥—" },
        { name: "Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø©", emoji: "ğŸ«˜" }
      ]
    };
    const affirmations = [
      "Ø£Ù†Ø§ Ù‚ÙˆÙŠ ÙˆÙ‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙŠ! ğŸ’ª",
      "Ø£Ù†Ø§ Ù…Ø­Ø¨ÙˆØ¨ ÙˆÙ…Ù…ÙŠØ²! â¤ï¸",
      "ÙƒÙ„ ÙŠÙˆÙ… Ø£ØµØ¨Ø­ Ø£ÙØ¶Ù„! âœ¨",
      "Ø£Ø³ØªØ·ÙŠØ¹ Ø£Ù† Ø£ØªØ¹Ù„Ù… Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ø±ÙŠØ¯Ù‡! ğŸŒŸ",
      "Ø£Ù†Ø§ Ø³Ø¹ÙŠØ¯ ÙˆÙ…Ø¨Ø¯Ø¹! ğŸ¨",
      "Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØºÙ„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª! ğŸš€",
      "Ø£Ù†Ø§ ØµØ¯ÙŠÙ‚ Ø±Ø§Ø¦Ø¹! ğŸ¤—"
    ];
    // ================= Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø³Ø§Ø¨Ø§Øª ================
    let users = JSON.parse(localStorage.getItem(usersKey)) || [];
    let session = JSON.parse(localStorage.getItem(sessionKey)) || null;
    // Ø¸Ù‡ÙˆØ± ÙˆØªØ¨Ø¯ÙŠÙ„ Ø­Ù‚ÙˆÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
    document.getElementById('acc-type').onchange = function() {
      document.getElementById('acc-block-child').classList.toggle('hidden', this.value!=='child');
      document.getElementById('acc-block-parent').classList.toggle('hidden', this.value!=='parent');
      document.getElementById('acc-block-admin').classList.toggle('hidden', this.value!=='admin');
      document.getElementById('auth-msg').innerText = '';
      document.getElementById('pending-msg').classList.add('hidden');
    };

    // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„
    document.getElementById('login-btn').onclick = function() {
      let type = document.getElementById('acc-type').value;
      if(type==='child') {
        let email = document.getElementById('child-email').value.trim();
        let pass = document.getElementById('child-pass').value;
        let user = users.find(u => u.type==='child'&&u.email===email);
        if(user){
          if(user.pass!==pass) return msg('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
          if(user.pending) return waitMsg();
          session = {type:'child', name:user.name, email:email};
          saveSession();
          showGame();
        } else {
          msg('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³Ø¬Ù„ Ù…Ù† Ø¬Ø¯ÙŠØ¯.');
        }
      } else if(type==='parent') {
        let email = document.getElementById('parent-email').value.trim();
        let child = document.getElementById('parent-child-email').value.trim();
        let pass = document.getElementById('parent-pass').value;
        let user = users.find(u => u.type==='parent'&&u.email===email&&u.child===child);
        if(user){
          if(user.pass!==pass) return msg('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
          if(user.pending) return waitMsg();
          session = {type:'parent', name:user.name, email:email, child};
          saveSession();
          alert("Ù…Ø³Ø§Ø­Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± ØºÙŠØ± Ù…ÙØ¹Ù„Ø© ÙÙŠ Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø®ØªØµØ±Ø©.\nØ§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ© ØªØ¯Ø¹Ù… Ø°Ù„Ùƒ!");
        } else msg('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯.');
      } else if(type==='admin') {
        let pass = document.getElementById('admin-pass').value;
        if(pass!==adminPass) return msg('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
        session={type:'admin'};
        saveSession();
        alert("Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± Ù…ÙØ¹Ù„Ø© Ø¨Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©.\nÙŠÙ…ÙƒÙ†Ùƒ ØªÙØ¹ÙŠÙ„Ù‡Ø§ ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ.");
      }
    };

    // Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
    document.getElementById('reg-btn').onclick = function() {
      let type = document.getElementById('acc-type').value;
      if(type==='child'){
        let name = document.getElementById('child-name').value.trim(); if(!name) return msg('Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ!');
        let email = document.getElementById('child-email').value.trim();
        let pass = document.getElementById('child-pass').value;
        if(users.some(u=>u.email===email)) return msg('Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!');
        users.push({type:'child',name,email,pass,pending:true});
        localStorage.setItem(usersKey,JSON.stringify(users));
        waitMsg();
      }
      else if(type==='parent'){
        let name = document.getElementById('parent-name').value.trim();
        let email = document.getElementById('parent-email').value.trim();
        let child = document.getElementById('parent-child-email').value.trim();
        let pass = document.getElementById('parent-pass').value;
        if(!name||!email||!child||!pass) return msg('Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
        if(users.some(u=>u.email===email&&u.type==='parent')) return msg('Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù…Ø³Ø¬Ù„!');
        users.push({type:'parent',name,email,child,pass,pending:true});
        localStorage.setItem(usersKey,JSON.stringify(users));
        waitMsg();
      }
      else { msg('ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± Ù…ØªØ§Ø­!'); }
    };
    // Ø±Ø³Ø§Ø¦Ù„
    function msg(t){document.getElementById('auth-msg').innerText=t;}
    function waitMsg(){ document.getElementById('pending-msg').classList.remove('hidden'); }

    // Ø¬Ù„Ø³Ø© ÙˆØ­Ø§Ù„Ø© Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ
    function saveSession(){localStorage.setItem(sessionKey,JSON.stringify(session));}
    function clearSession(){localStorage.removeItem(sessionKey);session=null;}
    function getChildName(){
      if(!session) return "";
      return session.name||"";
    }

    //==================== Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ===============
    function showGame() {
      document.getElementById('auth-section').classList.add('hidden');
      document.getElementById('game-section').classList.remove('hidden');
      loadStats();
      welcomeBot();
      picUpdate();
    }
    function logout(){
      clearSession();
      document.querySelectorAll('main > div').forEach(x=>x.classList.add('hidden'));
      document.getElementById('auth-section').classList.remove('hidden');
    }
    // ØªØ±Ø­ÙŠØ¨ Ø§Ù„Ø¨ÙˆØª Ø¨Ø§Ø³Ù… Ø§Ù„Ø·ÙÙ„
    function welcomeBot(){
      let n = getChildName(), text =
        n ? `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${n}! Ø£Ù†Ø§ Talevia Bot ÙˆØ±ÙÙŠÙ‚Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„ÙŠÙˆÙ… ğŸ‘‹.`:
        "Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Talevia Game!";
      botText(text,"ğŸ¤—");
      speak(text);
    }

    // =================== Ø§Ù„Ø£Ù†Ø´Ø·Ø© =======================
    function openAct(act){ hideAll(); document.getElementById(act+'-section').classList.remove('hidden');
      if(act==='food') loadMealStatus();
      if(act==='water') loadWater();
      if(act==='exercise') resetExercise();
      if(act==='mood') document.getElementById('mood-msg').innerText="";
      if(act==='sleep') newAffirmation();
    }
    function closeAct(act){ document.getElementById(act+'-section').classList.add('hidden'); showGame(); }
    function hideAll(){ document.querySelectorAll('main > div').forEach(x=>x.classList.add('hidden')); }

    //========= Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„ØºØ°Ø§Ø¦ÙŠ ===========
    function loadMealStatus(){
      document.getElementById("meal-content").innerHTML = "";
    }
    function openMeal(type){
      let progress = getTodayProg();
      if(progress["meal_"+type]){ setMsg("food-msg","Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª ÙˆØ¬Ø¨Ø© "+type+" Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ…!"); return;}
      let html = "<div style='margin:20px 4px'>";
      foods[type].forEach(f=>{
        html+= `<button class="btn" onclick="selectFood('${type}','${f.name}','${f.emoji}')">${f.emoji} ${f.name}</button>`;
      });
      html+="</div>";
      document.getElementById("meal-content").innerHTML=html;
    }
    function selectFood(type,food,emoji){
      let progress = getTodayProg();
      if(progress["meal_"+type]){ setMsg("food-msg","Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª ÙˆØ¬Ø¨ØªÙƒ Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
      progress["meal_"+type]=food;
      addPoints(10,1); saveTodayProg(progress);
      setMsg("food-msg",`${emoji} Ø£Ø­Ø³Ù†Øª! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 10 Ù†Ù‚Ø§Ø· ÙˆÙ†Ø¬Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± ${food}`);
      setTimeout(function(){closeAct('food');},1800);
      botText(`${emoji} Ø§Ø®ØªÙŠØ§Ø± Ù…Ù…ØªØ§Ø² ÙŠØ§ Ø¨Ø·Ù„!`);
      speak(`${emoji} Ø§Ø®ØªÙŠØ§Ø± Ù…Ù…ØªØ§Ø² ÙŠØ§ ${getChildName()}!`);
    }
    //========= Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ ===========
    function loadWater(){
      let progress = getTodayProg();
      let c = progress.water||0;
      let html = "";
      for(let i=1;i<=8;i++)
        html += `<span class="cup ${i<=c?'filled':''}" onclick="drinkCup(${i})"></span>`;
      document.getElementById("cup-row").innerHTML=html;
      document.getElementById("cup-count").innerText = c;
    }
    function drinkCup(num){
      let progress = getTodayProg();
      let cc = progress.water||0;
      if(num<=cc){ setMsg("water-msg","ØªÙ… Ø´Ø±Ø¨ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ Ø¨Ø§Ù„ÙØ¹Ù„!"); return;}
      progress.water = num;
      addPoints(2,1); saveTodayProg(progress);
      setMsg("water-msg",`Ø´Ø±Ø¨Øª ÙƒÙˆØ¨ Ø±Ù‚Ù… ${num}! +2 Ù†Ù‚Ø§Ø· +Ù†Ø¬Ù…Ø©`);
      loadWater(); botText("Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ Ù„ØµØ­Ø© Ø£ÙØ¶Ù„! ğŸ’§"); speak("Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠØ§ "+getChildName());
    }
    //========= Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ ===========
    const exercisesList = {
      running: {name:"Ø§Ù„Ø¬Ø±ÙŠ",emoji:"ğŸƒâ€â™‚ï¸",min:2},
      swimming: {name:"Ø§Ù„Ø³Ø¨Ø§Ø­Ø©",emoji:"ğŸŠâ€â™‚ï¸",min:3},
      yoga: {name:"ÙŠÙˆØ¬Ø§",emoji:"ğŸ§˜",min:1},
      cycling: {name:"Ø¯Ø±Ø§Ø¬Ø©",emoji:"ğŸš´",min:5}
    };
    let exerciseTimer = null, exerciseSec=0, exerciseType="";
    function resetExercise(){
      document.getElementById("exercise-content").innerHTML="";
      exerciseSec=0; exerciseType="";
      if(exerciseTimer){clearInterval(exerciseTimer);exerciseTimer=null;}
      document.getElementById("exercise-msg").innerText="";
    }
    function openExercise(type){
      let progress = getTodayProg();
      if(progress["exercise_"+type]){ setMsg("exercise-msg","Ø£Ù†Ù‡ÙŠØª Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
      exerciseType=type; exerciseSec=0;
      document.getElementById("exercise-content").innerHTML=`
        <div style="font-size:1.2em;text-align:center;">
          ${exercisesList[type].emoji} ${exercisesList[type].name}
        </div>
        <div id="timer" style="font-size:2em;color:#51bbf6;margin:13px 0;">00:00</div>
        <button class="btn" onclick="startEx()">â–¶ï¸ Ø§Ø¨Ø¯Ø£</button>
        <button class="btn" onclick="endEx()">âœ… Ø¥Ù†Ù‡Ø§Ø¡</button>
      `;
    }
    function startEx(){
      if(exerciseTimer) return;
      exerciseTimer = setInterval(()=>{
        exerciseSec++;
        document.getElementById('timer').innerText =
          `${("0"+Math.floor(exerciseSec/60)).slice(-2)}:${("0"+(exerciseSec%60)).slice(-2)}`;
      },1000);
    }
    function endEx(){
      if(exerciseTimer){clearInterval(exerciseTimer);exerciseTimer=null;}
      if(exerciseSec<exercisesList[exerciseType].min*60)
        return setMsg("exercise-msg",`ØªÙ…Ø±Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ${exercisesList[exerciseType].min} Ø¯Ù‚Ø§Ø¦Ù‚!`);
      let mins = Math.floor(exerciseSec/60);
      let points = mins*5;
      let progress = getTodayProg();
      progress["exercise_"+exerciseType]=1;
      addPoints(points,2); saveTodayProg(progress);
      setMsg("exercise-msg",`Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª ${mins} Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ­ØµÙ„Øª Ø¹Ù„Ù‰ ${points} Ù†Ù‚Ø·Ø©.`);
      setTimeout(function(){closeAct('exercise');},1800);
      botText("Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©!");
      speak("Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙŠØ§ "+getChildName());
    }
    //========= Ø§Ù„Ù…Ø´Ø§Ø¹Ø± ===========
    let selectedMood = "";
    function selectMood(mood){ selectedMood = mood; }
    function saveMood(){
      let progress = getTodayProg();
      if(progress.mood){ setMsg("mood-msg","Ø³Ø¬Ù„Øª Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
      let note = document.getElementById("mood-note").value.trim();
      if(!selectedMood && !note){ setMsg("mood-msg","Ø§Ø®ØªØ± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø´Ø¹ÙˆØ±Ùƒ!");return;}
      progress.mood = selectedMood+" "+note;
      addPoints(5,1); saveTodayProg(progress);
      setMsg("mood-msg","ØªÙ… Ø­ÙØ¸ Ù…Ø´Ø§Ø¹Ø±Ùƒ. Ø£Ø­Ø³Ù†Øª! +5 Ù†Ù‚Ø§Ø· +Ù†Ø¬Ù…Ø©");
      botText("Ø´Ø¹ÙˆØ± Ø¬Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…!"); speak("Ø´Ø¹ÙˆØ± Ø¬Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… ÙŠØ§ "+getChildName());
      setTimeout(function(){closeAct('mood');},1800);
    }
    //========= Ø§Ù„Ù†ÙˆÙ… ===========
    function saveSleep(){
      let hours = parseInt(document.getElementById("sleep-hours").value);
      let progress = getTodayProg();
      if(progress.sleep){ setMsg("sleep-msg","Ø³Ø¬Ù„Øª Ù†ÙˆÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
      if(isNaN(hours)||hours<1) return setMsg("sleep-msg","Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…!");
      let pts = hours>=8?15:hours>=6?10:5;
      progress.sleep=hours;
      addPoints(pts,1); saveTodayProg(progress);
      setMsg("sleep-msg","Ø£Ø­Ø³Ù†Øª! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ "+pts+" Ù†Ù‚Ø·Ø© ÙˆÙ†Ø¬Ù…Ø©.");
      botText("Ù†ÙˆÙ… ØµØ­ÙŠ Ù…Ù‡Ù… Ù„Ù„Ù†Ù…Ùˆ!"); speak("Ù†ÙˆÙ… ØµØ­ÙŠ Ù…Ù‡Ù… Ù„Ù„Ù†Ù…Ùˆ ÙŠØ§ "+getChildName());
      setTimeout(function(){closeAct('sleep');},1800);
    }
    function newAffirmation(){
      let txt = affirmations[Math.floor(Math.random()*affirmations.length)];
      document.getElementById("affirmation").innerText = txt;
      speak(txt);
    }
    // ============ Ù†Ù‚Ø§Ø· ÙˆÙ†Ø¬ÙˆÙ… ===========
    function addPoints(p,s){
      let progress = getTodayProg();
      progress.points = (progress.points||0)+p;
      progress.stars = (progress.stars||0)+s;
      saveTodayProg(progress);
      loadStats();
    }
    function loadStats(){
      let progress = getTodayProg();
      document.getElementById("stat-points").innerText = progress.points||0;
      document.getElementById("stat-stars").innerText = progress.stars||0;
      let val = Math.min(100,Math.round(((progress.points||0)/100)*100));
      let fill = document.getElementById("progress-bar");
      fill.style.width = val+"%";
      fill.innerText = val+"%";
    }
    // ============== Ø­ÙØ¸ Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø§Ù„ÙŠÙˆÙ… ===============
    function getTodayProg(){
      let all=JSON.parse(localStorage.getItem(progressKey))||{}, n = getChildName();
      let day = (new Date()).toLocaleDateString();
      all[n]=all[n]||{}; all[n][day]=all[n][day]||{};
      return all[n][day];
    }
    function saveTodayProg(prog){
      let all=JSON.parse(localStorage.getItem(progressKey))||{}, n = getChildName();
      let day = (new Date()).toLocaleDateString();
      all[n]=all[n]||{}; all[n][day]=prog;
      localStorage.setItem(progressKey,JSON.stringify(all));
      loadStats();
    }
    // ============== Ø§Ù„ØµÙˆØ± Ø§Ù„Ø´Ø®ØµÙŠØ© ===============
    document.getElementById('pic-upload').onchange = function(e){
      let file = e.target.files[0];
      if(!file) return;
      let r = new FileReader();
      r.onload = function(ev){
        let b = ev.target.result;
        localStorage.setItem(avatarKey, b);
        picUpdate();
      };
      r.readAsDataURL(file);
    };
    function picUpdate(){
      let b = localStorage.getItem(avatarKey)||"";
      let img = document.getElementById('user-pic');
      if(b){img.src=b;img.style.display='block';} else img.style.display='none';
    }
    // ========= Ø±ÙˆØ¨ÙˆØª Talevia Bot =============
    function botText(text,face){
      document.getElementById('bot-msg').innerText=text;
      document.getElementById('bot-face').innerText=face||"ğŸ¤—";
    }
    function speakBot(){
      let txt = document.getElementById('bot-msg').innerText;
      speak(txt);
    }
    function speak(txt){
      if(!('speechSynthesis' in window)) return;
      let utter = new SpeechSynthesisUtterance(txt);
      utter.lang="ar-EG"; utter.rate=1; utter.pitch=1.17;
      window.speechSynthesis.speak(utter);
    }

    // ============== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø£Ùˆ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ© ===============
    window.onload = function(){
      if(session && session.type==="child"){showGame();}
    };
  </script>
</body>
</html>

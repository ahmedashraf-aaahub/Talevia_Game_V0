<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Talevia Game - Ø§Ù„Ù„Ø¹Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ© Ø§Ù„Ø°ÙƒÙŠØ©</title>
  <style>
    body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #111 60%, #FF9740 100%); color: #222; margin:0; padding:0; min-height:100vh; direction:rtl;}
    header{background:linear-gradient(90deg,#FF9740 0%,#1a1a1a 80%);color:#fff;padding:16px 8px 8px 8px; text-align:center; border-bottom:4px solid #ff9740;position:relative;}
    .logo{max-width:88px;border-radius:18px;margin-bottom:7px;box-shadow:0 4px 22px rgba(255,151,64,0.22);}
    h1,h2,h3{color:#FF9740;}
    main{max-width:590px;margin:20px auto 0 auto;background:#fff;border-radius:18px;box-shadow:0 8px 32px rgba(255,151,64,0.10);padding:22px 15px 28px 15px;min-height:670px;position:relative;}
    .btn{background:linear-gradient(90deg,#FF9740 30%,#FFA54E 100%);color:#fff;border:none;border-radius:10px;padding:10px 23px;margin:9px 4px;font-weight:bold;font-size:1.01em;box-shadow:0 2px 12px rgba(255,151,64,.18);cursor:pointer;transition:background 0.2s,transform 0.15s;}
    .btn:hover{background:#353535;color:#FF9740;transform:scale(1.03);}
    .input-block{margin:13px 0; text-align: center;}
    input,select{border:2px solid #ff9740;background:#f0f5ff;border-radius:10px;padding:11px;font-size:1em;width:97%;color:#111;max-width:340px;margin:4px 0 11px 0;}
    .stars-count,.points-count{background:#111;color:#FFD700;padding:9px 11px;border-radius:12px;display:inline-block;font-size:1.01em;margin:13px 10px 7px 10px;text-shadow:0 2px 9px #FFD70045;}
    .bar-bg{width:100%;height:24px;background:#eee;border-radius:12px;box-shadow:0 1px 6px #1567de18;overflow:hidden;position:relative;}
    .bar-fill{background:linear-gradient(90deg,#ff9740 10%,#51bbf6 90%);height:100%;min-width:24px;color:#fff;font-weight:bold;border-radius:12px;transition:width .6s;text-align:center;font-size:1em;line-height:24px;}
    .activity-list{margin:18px 0 13px 0;display:flex;flex-wrap:wrap;gap:15px;justify-content:space-around;}
    .activity-card, .act-card{flex:1 1 130px;min-width:120px;background:#FEF4EC;border:2px solid #FF9740;border-radius:12px;margin:7px;padding:11px 7px;text-align:center;cursor:pointer;transition:box-shadow .35s,transform .32s;font-size:1.13em;position:relative;min-height:58px;}
    .activity-card:hover, .act-card:hover{box-shadow:0 4px 20px #ff974022;background:#FFF8F1;transform:translateY(-2.5px) scale(1.04);}
    .emoji{font-size:2.1em;display:block;margin-bottom:7px;}
    .msg{color:#e74c3c;font-weight:bold;margin:7px 0 0 0; text-align: center;}
    .msg.ok{color:#10ad67;}
    .back-btn{background:#fff;color:#111;border:1.5px solid #ff9740;}
    .back-btn:hover{background:#FF9740;color:#fff;}
    .hidden{display:none !important;}
    /* Ø±ÙˆØ¨ÙˆØª */
    .bot-area{margin:13px 0 7px 0;text-align:center;}
    .bot{background:#111;width:77px;height:77px;border-radius:50%;margin:0 auto;display:flex;align-items:center;justify-content:center;box-shadow:0 1px 22px #1567de22,0 0 18px #FF974050;animation:botFloat 2.15s infinite;}
    @keyframes botFloat{0%,100%{transform:translateY(0);}50%{transform:translateY(-13px);}}
    .bot-face{font-size:2.3em;user-select:none;color:#51bbf6;}
    .bot-text{color:#232323;background:#FFEBCD;padding:7px 12px;border-radius:13px;font-size:1.07em;margin:10px auto 2px auto;display:inline-block;min-width:80px;}
    .bot-speaker{display:inline-block;margin-right:7px;color:#51bbf6;cursor:pointer;}
    .mood-select .emoji, .mood-note{margin:9px 0;}
    .mood-note{width:80%;min-height:44px;}
    .cup-row{margin:11px 0;text-align:center;}
    .cup{width:38px;height:50px;background:#c6e6fb;border:2px solid #51bbf6;display:inline-block;margin:5px;border-radius:11px;cursor:pointer;transition:.3s;}
    .cup.filled{background:linear-gradient(180deg,#51bbf6 65%,#1567de 100%);}
    
    /* Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± */
    .admin-panel{background:#f7f9fa;border-radius:16px;padding:11px 6px;margin:4px 0;}
    .ad-section{margin:11px 0;}
    .ad-title{color:#ff9740;font-size:1.12em;text-align:center;margin:7px 0;}
    .list-box{background:#fff;border-radius:10px;padding:7px 4px;margin:10px 0;box-shadow:0 1px 6px #ffd70023;}
    .list-item{display:flex;justify-content:space-between;align-items:center;margin-bottom:6px;background:#F7EEDA;border-radius:7px;padding:7px;}
    .btn-accept{background:#51cf66;}
    .btn-refuse{background:#e74c3c;}
    .btn-del{background:#e74c3c;}
    .btn-info{background:#f2b806;}
    
    @media(max-width:620px){main{min-width:99vw!important;max-width:99vw!important;padding:8px 0px;}}
    @media(max-width:400px){.btn{font-size:.96em;padding:8px 6px;min-width:64px;}}
    .auth-buttons { text-align: center; margin-top: 15px; }
    
    /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ© */
    #user-pic {
        object-fit: cover;
        transition: transform 0.3s ease;
    }
    #user-pic:hover {
        transform: scale(1.05);
    }
  </style>
</head>
<body>
<header>
  <img src="1000365989.jpeg" class="logo" alt="Talevia Logo" onerror="this.style.display='none'" />
  <h1>Talevia Game</h1>
</header>
<main>
    <div id="auth-section">
    <h2 style="text-align:center;color:#FF9740;">ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„</h2>
    
    <div class="input-block">
      <label>Ø£Ù†Øª:</label>
      <select id="acc-type">
        <option value="child">Ø·ÙÙ„ ğŸ‘¦</option>
        <option value="parent">ÙˆÙ„ÙŠ Ø£Ù…Ø± ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦</option>
        <option value="admin">Ù…Ø¯ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù… ğŸ”</option>
      </select>
    </div>

    <div id="acc-block-child" class="input-block">
      <input type="text" id="child-name" placeholder="Ø§Ù„Ø§Ø³Ù… (Ù„Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯)" />
      <input type="email" id="child-email" placeholder="Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ" />
      <input type="password" id="child-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
    </div>

    <div id="acc-block-parent" class="input-block hidden">
      <input type="text" id="parent-name" placeholder="Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" />
      <input type="email" id="parent-email" placeholder="Ø¨Ø±ÙŠØ¯ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±" />
      <input type="email" id="parent-child-email" placeholder="Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ù…Ø±ØªØ¨Ø·" />
      <input type="password" id="parent-pass" placeholder="ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±" />
    </div>

    <div id="acc-block-admin" class="input-block hidden">
      <input type="password" id="admin-pass" placeholder="ÙƒÙˆØ¯ Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø³Ø±ÙŠ" />
    </div>

    <div class="auth-buttons">
      <button class="btn" id="login-btn">Ø¯Ø®ÙˆÙ„</button>
      <button class="btn" id="reg-btn">ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯</button>
    </div>

    <div class="msg" id="auth-msg"></div>
    <div class="msg ok hidden" id="pending-msg">ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø·Ù„Ø¨Ùƒ Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù†ØªØ¸Ø± Ù…ÙˆØ§ÙÙ‚Ø© Ø§Ù„Ù…Ø¯ÙŠØ±.</div>
  </div>

  <div id="admin-panel" class="admin-panel hidden">
    <h2 class="ad-title">ğŸ” Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Talevia Admin</h2>
    <div class="ad-section">
      <b>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø©:</b>
      <div id="req-list" class="list-box"></div>
    </div>
    <div class="ad-section">
      <b>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†:</b>
      <div id="user-list" class="list-box"></div>
    </div>
    <button class="btn back-btn" onclick="adminLogout()">ğŸšª Ø®Ø±ÙˆØ¬</button>
  </div>

  <div id="game-section" class="hidden">
    <div class="bot-area">
      <div class="bot"><span class="bot-face" id="bot-face">ğŸ¤–</span></div>
      <div class="bot-text" id="bot-msg">
        Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ø¨Ø·Ù„! Ø£Ù†Ø§ Talevia Bot.<span class="bot-speaker" title="ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª" onclick="speakBot()">ğŸ”Š</span>
      </div>
    </div>
    <div style="text-align:center;">
      <span class="stars-count">â­ Ø§Ù„Ù†Ø¬ÙˆÙ…: <span id="stat-stars">0</span></span>
      <span class="points-count">ğŸ† Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="stat-points">0</span></span>
      <div class="bar-bg"><div class="bar-fill" id="progress-bar" style="width:0%">0%</div></div>
    </div>
    
    <div style="text-align:center;margin:15px 0;">
      <input type="file" id="pic-upload" accept="image/*" style="display:none;">
      <button class="btn" onclick="document.getElementById('pic-upload').click();" style="display:block; margin: 0 auto 10px auto;">ğŸ“· ØªØ­Ù…ÙŠÙ„ ØµÙˆØ±Ø© Ø´Ø®ØµÙŠØ©</button>
      <img id="user-pic" src="" 
           style="width:100px; height:100px; display:none; margin: 10px auto; border-radius:50%; border:3px solid #ff9740; box-shadow:0 4px 10px rgba(0,0,0,0.2);" 
           alt="ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„" />
    </div>

    <h3 style="text-align:center;">Ø§Ø®ØªØ± Ù†Ø´Ø§Ø·Ùƒ Ø§Ù„ÙŠÙˆÙ…ÙŠ</h3>
    <div class="activity-list">
      <div class="activity-card" onclick="openAct('food')"><span class="emoji">ğŸ¥—</span>Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ</div>
      <div class="activity-card" onclick="openAct('water')"><span class="emoji">ğŸ’§</span>Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡</div>
      <div class="activity-card" onclick="openAct('exercise')"><span class="emoji">ğŸƒ</span>Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ</div>
      <div class="activity-card" onclick="openAct('mood')"><span class="emoji">ğŸ˜Š</span>Ø§Ù„Ù…Ø´Ø§Ø¹Ø±</div>
      <div class="activity-card" onclick="openAct('sleep')"><span class="emoji">ğŸŒ™</span>Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ</div>
    </div>
    <div style="text-align:center;"><button class="btn back-btn" onclick="logout()">ğŸšª Ø®Ø±ÙˆØ¬</button></div>
  </div>

  <div id="food-section" class="hidden">
    <h2>ğŸ¥— Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ - Talevia Game</h2>
    <div><b>Ø§Ø®ØªØ± Ø§Ù„ÙˆØ¬Ø¨Ø©:</b></div>
    <div class="activity-list" style="flex-wrap:nowrap;">
      <div class="activity-card" onclick="openMeal('breakfast')"><span class="emoji">ğŸŒ…</span>Ø§Ù„ÙØ·ÙˆØ±</div>
      <div class="activity-card" onclick="openMeal('lunch')"><span class="emoji">â˜€ï¸</span>Ø§Ù„ØºØ¯Ø§Ø¡</div>
      <div class="activity-card" onclick="openMeal('dinner')"><span class="emoji">ğŸŒ™</span>Ø§Ù„Ø¹Ø´Ø§Ø¡</div>
    </div>
    <div id="meal-content"></div>
    <button class="btn back-btn" onclick="closeAct('food')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <div class="msg" id="food-msg"></div>
  </div>

  <div id="water-section" class="hidden">
    <h2>ğŸ’§ Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡ - Talevia Game</h2>
    <div class="cup-row" id="cup-row"></div>
    <div style="text-align:center;margin:6px;">Ø§Ù„Ø£ÙƒÙˆØ§Ø¨ Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø©: <span id="cup-count">0</span>/8</div>
    <button class="btn back-btn" onclick="closeAct('water')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <div class="msg" id="water-msg"></div>
  </div>

  <div id="exercise-section" class="hidden">
    <h2>ğŸƒ Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ - Talevia Game</h2>
    <div class="activity-list">
      <div class="activity-card" onclick="openExercise('running')"><span class="emoji">ğŸƒâ€â™‚ï¸</span>Ø§Ù„Ø¬Ø±ÙŠ</div>
      <div class="activity-card" onclick="openExercise('swimming')"><span class="emoji">ğŸŠâ€â™‚ï¸</span>Ø§Ù„Ø³Ø¨Ø§Ø­Ø©</div>
      <div class="activity-card" onclick="openExercise('yoga')"><span class="emoji">ğŸ§˜</span>ÙŠÙˆØ¬Ø§</div>
      <div class="activity-card" onclick="openExercise('cycling')"><span class="emoji">ğŸš´</span>Ø¯Ø±Ø§Ø¬Ø©</div>
    </div>
    <div id="exercise-content"></div>
    <button class="btn back-btn" onclick="closeAct('exercise')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <div class="msg" id="exercise-msg"></div>
  </div>

  <div id="mood-section" class="hidden">
    <h2>ğŸ˜Š Ø§Ù„Ù…Ø´Ø§Ø¹Ø± - Talevia Game</h2>
    <div class="mood-select flex-center" style="text-align:center;">
      <span class="emoji" onclick="selectMood('Ø³Ø¹ÙŠØ¯')">ğŸ˜Š</span>
      <span class="emoji" onclick="selectMood('Ø­Ø²ÙŠÙ†')">ğŸ˜¢</span>
      <span class="emoji" onclick="selectMood('ØºØ§Ø¶Ø¨')">ğŸ˜ </span>
      <span class="emoji" onclick="selectMood('Ù…ØªØ­Ù…Ø³')">ğŸ¤©</span>
      <span class="emoji" onclick="selectMood('Ù…ØªØ¹Ø¨')">ğŸ˜´</span>
      <span class="emoji" onclick="selectMood('Ù…Ø­Ø¨')">ğŸ˜</span>
    </div>
    <div style="text-align:center;">
        <textarea class="mood-note" id="mood-note" placeholder="ÙƒÙŠÙ ÙƒØ§Ù† ÙŠÙˆÙ…ÙƒØŸ"></textarea>
    </div>
    <div style="text-align:center;">
        <button class="btn" onclick="saveMood()">ğŸ’¾ Ø­ÙØ¸</button>
        <button class="btn back-btn" onclick="closeAct('mood')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    </div>
    <div class="msg" id="mood-msg"></div>
  </div>

  <div id="sleep-section" class="hidden">
    <h2>ğŸŒ™ Ø§Ù„Ù†ÙˆÙ… Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠ - Talevia Game</h2>
    <div class="input-block">
      <label>â° Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ù†ÙˆÙ…Ùƒ Ø§Ù„Ù„ÙŠÙ„Ø©:</label>
      <input type="number" min="0" max="12" id="sleep-hours" style="width:90px;text-align:center;" />
      <button class="btn" onclick="saveSleep()">ğŸ’¾ Ø­ÙØ¸</button>
    </div>
    <div style="margin:16px 0; background:#FEF4EC;padding:12px;border-radius:10px;">
      <b>âœ¨ ØªØ£ÙƒÙŠØ¯Ø§Øª Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©:</b>
      <div id="affirmation" style="font-size:1.11em;color:#51bbf6;margin:8px 0;"></div>
      <button class="btn" onclick="newAffirmation()">ğŸ”„ ØªØ£ÙƒÙŠØ¯ Ø¬Ø¯ÙŠØ¯</button>
    </div>
    <button class="btn back-btn" onclick="closeAct('sleep')">â†©ï¸ Ø±Ø¬ÙˆØ¹</button>
    <div class="msg" id="sleep-msg"></div>
  </div>
</main>
<script>
const progressKey = "talevia-progress";
const usersKey = "talevia-users";
const sessionKey = "talevia-session";
const reqKey = "talevia-requests";
const avatarKey = "talevia-avatar";
const adminPass = "talevia@0800";

// Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ÙˆØ¬Ø¨Ø§Øª ÙˆØ§Ù„Ø£Ù†Ø´Ø·Ø©
const foods = {
  breakfast: [
    { name: "Ø¨ÙŠØ¶ Ù…Ø³Ù„ÙˆÙ‚", emoji: "ğŸ¥š" },
    { name: "Ø´ÙˆÙØ§Ù† Ø¨Ø§Ù„ÙÙˆØ§ÙƒÙ‡", emoji: "ğŸ¥£" },
    { name: "ØªÙˆØ³Øª Ø¨Ø§Ù„Ø£ÙÙˆÙƒØ§Ø¯Ùˆ", emoji: "ğŸ¥‘" },
    { name: "Ø²Ø¨Ø§Ø¯ÙŠ Ø¨Ø§Ù„Ø¹Ø³Ù„", emoji: "ğŸ¯" },
    { name: "ÙÙˆØ§ÙƒÙ‡ Ø·Ø§Ø²Ø¬Ø©", emoji: "ğŸ" }
  ],
  lunch: [
    { name: "Ø³Ù„Ø·Ø© Ø®Ø¶Ø±Ø§Ø¡", emoji: "ğŸ¥—" },
    { name: "Ø¯Ø¬Ø§Ø¬ Ù…Ø´ÙˆÙŠ", emoji: "ğŸ—" },
    { name: "Ø£Ø±Ø² Ø¨Ù†ÙŠ", emoji: "ğŸš" },
    { name: "Ø³Ù…Ùƒ Ù…Ø´ÙˆÙŠ", emoji: "ğŸŸ" },
    { name: "Ø®Ø¶Ø§Ø± Ù…Ø·Ø¨ÙˆØ®Ø©", emoji: "ğŸ¥¦" }
  ],
  dinner: [
    { name: "Ø´ÙˆØ±Ø¨Ø© Ø®Ø¶Ø§Ø±", emoji: "ğŸ²" },
    { name: "Ø³Ø§Ù†Ø¯ÙˆÙŠØªØ´ ØµØ­ÙŠ", emoji: "ğŸ¥ª" },
    { name: "Ù…Ø¹ÙƒØ±ÙˆÙ†Ø© Ø¨Ø§Ù„Ø®Ø¶Ø§Ø±", emoji: "ğŸ" },
    { name: "Ø³Ù„Ø·Ø© ÙÙˆØ§ÙƒÙ‡", emoji: "ğŸ¥—" },
    { name: "Ø­Ù…Øµ Ø¨Ø§Ù„Ø·Ø­ÙŠÙ†Ø©", emoji: "ğŸ«˜" }
  ]
};
const affirmations = [
  "Ø£Ù†Ø§ Ù‚ÙˆÙŠ ÙˆÙ‚Ø§Ø¯Ø± Ø¹Ù„Ù‰ ØªØ­Ù‚ÙŠÙ‚ Ø£Ù‡Ø¯Ø§ÙÙŠ! ğŸ’ª",
  "Ø£Ù†Ø§ Ù…Ø­Ø¨ÙˆØ¨ ÙˆÙ…Ù…ÙŠØ²! â¤ï¸",
  "Ø£Ø³ØªØ·ÙŠØ¹ Ø£Ù† Ø£ØªØ¹Ù„Ù… Ø£ÙŠ Ø´ÙŠØ¡ Ø£Ø±ÙŠØ¯Ù‡! ğŸŒŸ",
  "Ø£Ø­Ø¨ Ù†ÙØ³ÙŠ ÙˆØ£Ù‡ØªÙ… Ø¨ØµØ­ØªÙŠ! ğŸŒˆ",
  "ÙƒÙ„ ÙŠÙˆÙ… Ø£ØµØ¨Ø­ Ø£ÙØ¶Ù„! âœ¨",
  "Ø£Ù†Ø§ Ø³Ø¹ÙŠØ¯ ÙˆÙ…Ø¨Ø¯Ø¹! ğŸ¨",
  "Ø£Ø³ØªØ·ÙŠØ¹ Ø§Ù„ØªØºÙ„Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØªØ­Ø¯ÙŠØ§Øª! ğŸš€",
  "Ø£Ù†Ø§ ØµØ¯ÙŠÙ‚ Ø±Ø§Ø¦Ø¹! ğŸ¤—"
];

// ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª ====
let users = JSON.parse(localStorage.getItem(usersKey)) || [];
let reqs = JSON.parse(localStorage.getItem(reqKey)) || [];
let session = JSON.parse(localStorage.getItem(sessionKey)) || null;

// ØªØºÙŠÙŠØ± Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¯Ø®ÙˆÙ„/Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
document.getElementById('acc-type').onchange = function() {
  let val = this.value;
  document.getElementById('acc-block-child').classList.toggle('hidden', val !== 'child');
  document.getElementById('acc-block-parent').classList.toggle('hidden', val !== 'parent');
  document.getElementById('acc-block-admin').classList.toggle('hidden', val !== 'admin');
  document.getElementById('auth-msg').innerText = '';
  document.getElementById('pending-msg').classList.add('hidden');
};

// ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
document.getElementById('login-btn').onclick = function() {
  let t = document.getElementById('acc-type').value;
  if (t === 'child') {
    let email = document.getElementById('child-email').value.trim();
    let pass = document.getElementById('child-pass').value;
    let user = users.find(u => u.type === 'child' && u.email === email);
    if (user) {
      if (user.pass !== pass) return msg('ÙƒÙ„Ù…Ø© Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
      if (!user.accepted) return waitMsg();
      session = { type: 'child', name: user.name, email: email };
      saveSession();
      showGame();
    } else msg('Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± ØµØ­ÙŠØ­Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯ØŒ Ø³Ø¬Ù‘Ù„ Ø¬Ø¯ÙŠØ¯.');
  } else if (t === 'parent') {
    let email = document.getElementById('parent-email').value.trim();
    let child = document.getElementById('parent-child-email').value.trim();
    let pass = document.getElementById('parent-pass').value;
    let user = users.find(
      u => u.type === 'parent' && u.email === email && u.child === child && u.pass === pass
    );
    user && user.accepted
      ? (session = { type: 'parent', name: user.name, email, child }, saveSession(), alert("Ù…Ø³Ø§Ø­Ø© ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù„Ù„ØªÙ‚Ø§Ø±ÙŠØ±... Ù‚ÙŠØ¯ Ø§Ù„Ø¹Ù…Ù„"))
      : msg('Ø¨ÙŠØ§Ù†Ø§Øª Ø®Ø§Ø·Ø¦Ø© Ø£Ùˆ Ø§Ù„Ø­Ø³Ø§Ø¨ Ù„Ù… ÙŠÙÙ‚Ø¨Ù„ Ø¨Ø¹Ø¯.');
  } else if (t === 'admin') {
    let pass = document.getElementById('admin-pass').value;
    if (pass !== adminPass)
      return msg('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©!');
    session = { type: 'admin' };
    saveSession();
    showAdmin();
  }
};

// ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯
document.getElementById('reg-btn').onclick = function() {
  let t = document.getElementById('acc-type').value;
  if(t === 'child') {
    let name = document.getElementById('child-name').value.trim();
    let email = document.getElementById('child-email').value.trim();
    let pass = document.getElementById('child-pass').value;
    if (!name || !email || !pass) return msg('Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
    if (users.some(u=>u.email === email && u.type==='child') || reqs.some(r=>r.email === email && r.type==='child'))
      return msg('Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„ Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!');
    reqs.push({type:'child',name,email,pass,accepted:false});
    localStorage.setItem(reqKey, JSON.stringify(reqs));
    waitMsg();
  }
  else if(t === 'parent'){
    let name = document.getElementById('parent-name').value.trim();
    let email = document.getElementById('parent-email').value.trim();
    let child = document.getElementById('parent-child-email').value.trim();
    let pass = document.getElementById('parent-pass').value;
    if (!name || !email || !child || !pass) return msg('Ø§ÙƒÙ…Ù„ ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙˆÙ„!');
    if (users.some(u=>u.email === email && u.type==='parent') || reqs.some(r=>r.email === email && r.type==='parent'))
      return msg('Ø¥ÙŠÙ…ÙŠÙ„ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø± Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙØ¹Ù„!');
    reqs.push({type:'parent',name,email,child,pass,accepted:false});
    localStorage.setItem(reqKey, JSON.stringify(reqs));
    waitMsg();
  }
  else msg("ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù…Ø¯ÙŠØ± ØºÙŠØ± Ù…ØªØ§Ø­!");
};

function msg(t){ document.getElementById('auth-msg').innerText = t; }
function waitMsg(){ document.getElementById('pending-msg').classList.remove('hidden'); }

function saveSession(){localStorage.setItem(sessionKey,JSON.stringify(session));}
function clearSession(){localStorage.removeItem(sessionKey);session=null;}

// ========== Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ± ==========
function showAdmin(){
  hideAll();
  document.getElementById('admin-panel').classList.remove('hidden');
  updateAdminLists();
}
function updateAdminLists(){
  let RL = document.getElementById('req-list');
  RL.innerHTML = "";
  reqs = JSON.parse(localStorage.getItem(reqKey)) || [];
  if(reqs.length===0) RL.innerHTML = "<div class='msg ok'>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ø¬Ø¯ÙŠØ¯Ø©</div>";
  else reqs.forEach((r, i) => {
    RL.innerHTML += `
    <div class='list-item'>
      <span>${r.type==="child"?"ğŸ‘¦":"ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦"} ${r.name||r.email} (${r.email})</span>
      <span>
        <button class="btn btn-accept" onclick="acceptReq(${i})">Ù…ÙˆØ§ÙÙ‚Ø©</button>
        <button class="btn btn-refuse" onclick="refuseReq(${i})">Ø±ÙØ¶</button>
      </span>
    </div>
    `;
  });
  let UL = document.getElementById('user-list');
  UL.innerHTML = "";
  users = JSON.parse(localStorage.getItem(usersKey)) || [];
  users.forEach((u, i) => {
    let p = getTodayProg(u.name);
    UL.innerHTML += `
    <div class='list-item'>
      <span>${u.type==="child"?"ğŸ‘¦":"ğŸ‘¨â€ğŸ‘©â€ğŸ‘¦"} <b>${u.name||"--"}</b> (${u.email})</span>
      <span>
        <button class="btn btn-info" onclick="showUserInfo(${i})">Ø¨ÙŠØ§Ù†Ø§Øª</button>
        <button class="btn btn-del" onclick="delUser(${i})">Ø­Ø°Ù</button>
      </span>
    </div>`;
  });
}
window.acceptReq = function(idx){
  let req = reqs[idx]; req.accepted = true;
  users.push(req); reqs.splice(idx,1);
  localStorage.setItem(usersKey,JSON.stringify(users));
  localStorage.setItem(reqKey,JSON.stringify(reqs));
  updateAdminLists();
};
window.refuseReq = function(idx){
  reqs.splice(idx,1);
  localStorage.setItem(reqKey,JSON.stringify(reqs));
  updateAdminLists();
};
window.delUser = function(idx){
  if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ")) return;
  users.splice(idx,1);
  localStorage.setItem(usersKey,JSON.stringify(users));
  updateAdminLists();
};
window.showUserInfo = function(idx){
  let u = users[idx];
  let p = getTodayProg(u.name);
  alert(
    `Ø§Ù„Ø§Ø³Ù…: ${u.name||""}
Ø§Ù„Ø¥ÙŠÙ…ÙŠÙ„: ${u.email}
Ø§Ù„Ù†ÙˆØ¹: ${u.type==='child'?'Ø·ÙÙ„':'ÙˆÙ„ÙŠ Ø£Ù…Ø±'}
Ù†Ù‚Ø§Ø· Ø§Ù„ÙŠÙˆÙ…: ${p.points||0} ğŸ†`
  );
};
function adminLogout(){
  clearSession();
  hideAll();
  document.getElementById('auth-section').classList.remove('hidden');
}

// ============== Ø§Ù„Ø£Ù†Ø´Ø·Ø© ÙˆØ§Ù„ÙˆØ¸Ø§Ø¦Ù ==============
function hideAll(){ document.querySelectorAll('main > div').forEach(x=>x.classList.add('hidden')); }

function showGame() {
  hideAll(); document.getElementById('game-section').classList.remove('hidden');
  loadStats(); welcomeBot(); picUpdate();
}

function logout(){
  clearSession(); hideAll();document.getElementById('auth-section').classList.remove('hidden');
}

// ==== Ø§Ù„Ø±ÙˆØ¨ÙˆØª ÙˆØ§Ù„ØªØ­ÙÙŠØ² ====
function welcomeBot(){
  let n = getChildName();
  let t = n? `Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ ${n}! Ø£Ù†Ø§ Talevia Bot ÙˆØ±ÙÙŠÙ‚Ùƒ Ø§Ù„ØµØ­ÙŠ Ø§Ù„ÙŠÙˆÙ… ğŸ‘‹.`:"Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Talevia Game!";
  botText(t,"ğŸ¤—"); speak(t);
}
function botText(txt,face){document.getElementById('bot-msg').innerText=txt;document.getElementById('bot-face').innerText=face||"ğŸ¤—";}
function speakBot(){ let txt = document.getElementById('bot-msg').innerText; speak(txt);}
function speak(txt){
  if(!('speechSynthesis' in window)) return;
  let utter = new SpeechSynthesisUtterance(txt); utter.lang="ar-EG"; utter.rate=1; utter.pitch=1.13;
  window.speechSynthesis.speak(utter);
}

// ==== Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø·ÙÙ„ Ø§Ù„Ø­Ø§Ù„ÙŠ ÙˆØ§Ù„ØªÙ‚Ø¯Ù… (ØªÙ… Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ù„Ø¥ØµÙ„Ø§Ø­) ====
function getChildName(){if(!session) return ""; return session.name||"";}

// Ø¯Ø§Ù„Ø© Ù…ÙˆØ­Ø¯Ø© Ù„Ù„ØªØ§Ø±ÙŠØ® Ù„ØªØ¬Ù†Ø¨ Ø§Ø®ØªÙ„Ø§Ù Ø§Ù„ØªÙ†Ø³ÙŠÙ‚
function getTodayDateString() {
    return new Date().toDateString(); // ÙŠØ¹Ø·ÙŠ ØµÙŠØºØ© Ù…Ø«Ù„ "Sat Nov 22 2025"
}

// Ø¬Ù„Ø¨ Ø§Ù„ØªÙ‚Ø¯Ù… (Ù„Ù„Ù‚Ø±Ø§Ø¡Ø© ÙÙ‚Ø·)
function getTodayProg(name){
  let all=JSON.parse(localStorage.getItem(progressKey))||{}, n = name||getChildName();
  let day = getTodayDateString();
  if(!all[n]) return {};
  if(!all[n][day]) return {};
  return all[n][day];
}

// Ø¯Ø§Ù„Ø© Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø· ÙˆØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© (ØªÙ… Ø§Ù„Ø¥ØµÙ„Ø§Ø­)
function addPoints(pointsToAdd, starsToAdd){
    let name = getChildName();
    if(!name) return;

    let all = JSON.parse(localStorage.getItem(progressKey)) || {};
    let day = getTodayDateString();

    // ØªØ£ÙƒØ¯ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
    if (!all[name]) all[name] = {};
    if (!all[name][day]) all[name][day] = { points: 0, stars: 0, water: 0 };

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù†Ù‚Ø§Ø·
    all[name][day].points = (all[name][day].points || 0) + pointsToAdd;
    all[name][day].stars = (all[name][day].stars || 0) + starsToAdd;

    // Ø­ÙØ¸ ÙÙŠ Ø§Ù„Ø°Ø§ÙƒØ±Ø©
    localStorage.setItem(progressKey, JSON.stringify(all));

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© ÙÙˆØ±Ø§Ù‹
    loadStats();
}

// Ø¯Ø§Ù„Ø© ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù†Ø´Ø§Ø· (Ù…Ø«Ù„ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ø·Ø¹Ø§Ù… Ø£Ùˆ Ø§Ù„Ù…Ø§Ø¡)
function updateActivityData(key, value) {
    let name = getChildName();
    if(!name) return;

    let all = JSON.parse(localStorage.getItem(progressKey)) || {};
    let day = getTodayDateString();

    if (!all[name]) all[name] = {};
    if (!all[name][day]) all[name][day] = { points: 0, stars: 0 };

    all[name][day][key] = value;
    localStorage.setItem(progressKey, JSON.stringify(all));
}

function loadStats(){
  let prog = getTodayProg();
  let pts = prog.points || 0;
  let strs = prog.stars || 0;
  
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
  document.getElementById("stat-points").innerText = pts;
  document.getElementById("stat-stars").innerText = strs;
  
  // Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© (Ø§Ù„Ù‡Ø¯Ù Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ 100 Ù†Ù‚Ø·Ø©)
  let val = Math.min(100, Math.round((pts / 100) * 100));
  
  let fill = document.getElementById("progress-bar");
  fill.style.width = val + "%";
  fill.innerText = val + "%";
}

// ========== ØµÙˆØ±Ø© Ø§Ù„Ø·ÙÙ„ ==========
document.getElementById('pic-upload').onchange = function(e){
  let file = e.target.files[0]; if(!file) return;
  let r = new FileReader();
  r.onload = function(ev){
    let b = ev.target.result; localStorage.setItem(avatarKey, b); picUpdate();
  };
  r.readAsDataURL(file);
};
function picUpdate(){
  let b = localStorage.getItem(avatarKey)||"";
  let img = document.getElementById('user-pic');
  if(b){img.src=b;img.style.display='block';} else img.style.display='none';
}

// ====== Ø§Ù„Ø£Ù†Ø´Ø·Ø© Ø§Ù„Ø®Ù…Ø³Ø© ØªÙØµÙŠÙ„Ù‹Ø§ ======
// Ø§Ù„Ø·Ø¹Ø§Ù… Ø§Ù„ØµØ­ÙŠ
function openAct(act){hideActs(); document.getElementById(act+'-section').classList.remove('hidden');
  if(act==='food')loadMealStatus();
  if(act==='water')loadWater();
  if(act==='exercise')resetExercise();
  if(act==='mood')document.getElementById('mood-msg').innerText="";
  if(act==='sleep')newAffirmation();
}
function closeAct(act){ document.getElementById(act+'-section').classList.add('hidden'); showGame(); }
function hideActs(){ document.querySelectorAll('main > div').forEach(x=>x.classList.add('hidden')); }

function loadMealStatus(){ document.getElementById("meal-content").innerHTML = ""; }
function openMeal(type){
  let progress = getTodayProg();
  if(progress["meal_"+type]){ setMsg("food-msg","Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª ÙˆØ¬Ø¨Ø© "+type+" Ø¨Ø§Ù„ÙØ¹Ù„ Ø§Ù„ÙŠÙˆÙ…!"); return;}
  let html = "<div style='margin:20px 4px'>";
  foods[type].forEach(f => {
    html+= `<button class="btn" onclick="selectFood('${type}','${f.name}','${f.emoji}')">${f.emoji} ${f.name}</button>`;
  });
  html+="</div>";
  document.getElementById("meal-content").innerHTML=html;
}
function selectFood(type,food,emoji){
  let progress = getTodayProg();
  if(progress["meal_"+type]){ setMsg("food-msg","Ù„Ù‚Ø¯ Ø§Ø®ØªØ±Øª ÙˆØ¬Ø¨ØªÙƒ Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
  
  // Ø­ÙØ¸ Ù†ÙˆØ¹ Ø§Ù„ÙˆØ¬Ø¨Ø©
  updateActivityData("meal_"+type, food);
  
  // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù‚Ø§Ø·
  addPoints(10,1);
  
  setMsg("food-msg",`${emoji} Ø£Ø­Ø³Ù†Øª! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ 10 Ù†Ù‚Ø§Ø· ÙˆÙ†Ø¬Ù…Ø© Ø¨Ø¹Ø¯ Ø§Ø®ØªÙŠØ§Ø± ${food}`);
  setTimeout(()=>closeAct('food'),1800); botText(`${emoji} Ø§Ø®ØªÙŠØ§Ø± Ù…Ù…ØªØ§Ø² ÙŠØ§ Ø¨Ø·Ù„!`); speak(`${emoji} Ø§Ø®ØªÙŠØ§Ø± Ù…Ù…ØªØ§Ø² ÙŠØ§ ${getChildName()}!`);
}

// Ø´Ø±Ø¨ Ø§Ù„Ù…Ø§Ø¡
function loadWater(){
  let progress = getTodayProg(), c = progress.water||0, html = "";
  for(let i=1;i<=8;i++) html += `<span class="cup ${i<=c?'filled':''}" onclick="drinkCup(${i})"></span>`;
  document.getElementById("cup-row").innerHTML=html;
  document.getElementById("cup-count").innerText = c;
}
function drinkCup(num){
  let progress = getTodayProg(), cc = progress.water||0;
  if(num<=cc){ setMsg("water-msg","ØªÙ… Ø´Ø±Ø¨ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¨ Ø¨Ø§Ù„ÙØ¹Ù„!"); return;}
  
  updateActivityData("water", num);
  addPoints(2,1);
  
  setMsg("water-msg",`Ø´Ø±Ø¨Øª ÙƒÙˆØ¨ Ø±Ù‚Ù… ${num}! +2 Ù†Ù‚Ø§Ø· +Ù†Ø¬Ù…Ø©`);
  loadWater(); botText("Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ Ù„ØµØ­Ø© Ø£ÙØ¶Ù„! ğŸ’§"); speak("Ø§Ø´Ø±Ø¨ Ø§Ù„Ù…Ø²ÙŠØ¯ Ù…Ù† Ø§Ù„Ù…Ø§Ø¡ ÙŠØ§ "+getChildName());
}

// Ø§Ù„Ù†Ø´Ø§Ø· Ø§Ù„Ø¨Ø¯Ù†ÙŠ
const exercisesList = { running: {name:"Ø§Ù„Ø¬Ø±ÙŠ",emoji:"ğŸƒâ€â™‚ï¸",min:2}, swimming: {name:"Ø§Ù„Ø³Ø¨Ø§Ø­Ø©",emoji:"ğŸŠâ€â™‚ï¸",min:3}, yoga: {name:"ÙŠÙˆØ¬Ø§",emoji:"ğŸ§˜",min:1}, cycling: {name:"Ø¯Ø±Ø§Ø¬Ø©",emoji:"ğŸš´",min:5}};
let exerciseTimer = null, exerciseSec=0, exerciseType="";
function resetExercise(){
  document.getElementById("exercise-content").innerHTML="";
  exerciseSec=0; exerciseType="";
  if(exerciseTimer){clearInterval(exerciseTimer);exerciseTimer=null;}
  document.getElementById("exercise-msg").innerText="";
}
function openExercise(type){
  let progress = getTodayProg();
  if(progress["exercise_"+type]){ setMsg("exercise-msg","Ø£Ù†Ù‡ÙŠØª Ù‡Ø°Ø§ Ø§Ù„ØªÙ…Ø±ÙŠÙ† Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
  exerciseType=type; exerciseSec=0;
  document.getElementById("exercise-content").innerHTML=`
    <div style="font-size:1.15em;text-align:center;">
      ${exercisesList[type].emoji} ${exercisesList[type].name}
    </div>
    <div id="timer" style="font-size:2em;color:#51bbf6;margin:10px 0;">00:00</div>
    <button class="btn" onclick="startEx()">â–¶ï¸ Ø§Ø¨Ø¯Ø£</button>
    <button class="btn" onclick="endEx()">âœ… Ø¥Ù†Ù‡Ø§Ø¡</button>
  `;
}
function startEx(){
  if(exerciseTimer) return;
  exerciseTimer = setInterval(()=>{
    exerciseSec++;
    document.getElementById('timer').innerText = `${("0"+Math.floor(exerciseSec/60)).slice(-2)}:${("0"+(exerciseSec%60)).slice(-2)}`;
  },1000);
}
function endEx(){
  if(exerciseTimer){clearInterval(exerciseTimer);exerciseTimer=null;}
  if(exerciseSec<exercisesList[exerciseType].min*60) return setMsg("exercise-msg",`ØªÙ…Ø±Ù† Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„ ${exercisesList[exerciseType].min} Ø¯Ù‚Ø§Ø¦Ù‚!`);
  let mins = Math.floor(exerciseSec/60), points = mins*5;
  
  updateActivityData("exercise_"+exerciseType, 1);
  addPoints(points,2);
  
  setMsg("exercise-msg",`Ø£Ø­Ø³Ù†Øª! Ø£ÙƒÙ…Ù„Øª ${mins} Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ­ØµÙ„Øª Ø¹Ù„Ù‰ ${points} Ù†Ù‚Ø·Ø©.`);
  setTimeout(()=>closeAct('exercise'),1800); botText("Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©!"); speak("Ø¹Ù…Ù„ Ø±Ø§Ø¦Ø¹ ÙÙŠ Ø§Ù„ØªÙ…Ø§Ø±ÙŠÙ† Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙŠØ§ "+getChildName());
}

// Ø§Ù„Ù…Ø´Ø§Ø¹Ø±
let selectedMood = "";
function selectMood(mood){ selectedMood = mood; }
function saveMood(){
  let progress = getTodayProg();
  if(progress.mood){ setMsg("mood-msg","Ø³Ø¬Ù„Øª Ù…Ø´Ø§Ø¹Ø±Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
  let note = document.getElementById("mood-note").value.trim();
  if(!selectedMood && !note){ setMsg("mood-msg","Ø§Ø®ØªØ± Ø£Ùˆ Ø§ÙƒØªØ¨ Ø´Ø¹ÙˆØ±Ùƒ!");return;}
  
  updateActivityData("mood", selectedMood+" "+note);
  addPoints(5,1);
  
  setMsg("mood-msg","ØªÙ… Ø­ÙØ¸ Ù…Ø´Ø§Ø¹Ø±Ùƒ. Ø£Ø­Ø³Ù†Øª! +5 Ù†Ù‚Ø§Ø· +Ù†Ø¬Ù…Ø©");
  botText("Ø´Ø¹ÙˆØ± Ø¬Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ…!"); speak("Ø´Ø¹ÙˆØ± Ø¬Ù…ÙŠÙ„ Ø§Ù„ÙŠÙˆÙ… ÙŠØ§ "+getChildName());
  setTimeout(()=>closeAct('mood'),1800);
}

// Ø§Ù„Ù†ÙˆÙ…
function saveSleep(){
  let hours = parseInt(document.getElementById("sleep-hours").value);
  let progress = getTodayProg();
  if(progress.sleep){ setMsg("sleep-msg","Ø³Ø¬Ù„Øª Ù†ÙˆÙ…Ùƒ Ø§Ù„ÙŠÙˆÙ… Ø¨Ø§Ù„ÙØ¹Ù„!");return;}
  if(isNaN(hours)||hours<1) return setMsg("sleep-msg","Ø£Ø¯Ø®Ù„ Ø¹Ø¯Ø¯ Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ù†ÙˆÙ…!");
  let pts = hours>=8?15:hours>=6?10:5;
  
  updateActivityData("sleep", hours);
  addPoints(pts,1);
  
  setMsg("sleep-msg","Ø£Ø­Ø³Ù†Øª! Ø­ØµÙ„Øª Ø¹Ù„Ù‰ "+pts+" Ù†Ù‚Ø·Ø© ÙˆÙ†Ø¬Ù…Ø©.");
  botText("Ù†ÙˆÙ… ØµØ­ÙŠ Ù…Ù‡Ù… Ù„Ù„Ù†Ù…Ùˆ!"); speak("Ù†ÙˆÙ… ØµØ­ÙŠ Ù…Ù‡Ù… Ù„Ù„Ù†Ù…Ùˆ ÙŠØ§ "+getChildName());
  setTimeout(()=>closeAct('sleep'),1800);
}
function newAffirmation(){
  let txt = affirmations[Math.floor(Math.random()*affirmations.length)];
  document.getElementById("affirmation").innerText = txt; speak(txt);
}

// ========== Ø£Ø¯ÙˆØ§Øª ÙˆØ±Ø³Ø§Ø¦Ù„ ==============
function setMsg(id,t){ document.getElementById(id).innerText=t; }

// ========== ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¬Ù„Ø³Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø¡ ===========
window.onload = function(){
  if(session && session.type==="child"){showGame();}
  else if(session && session.type==="admin"){showAdmin();}
};
</script>
</body>
</html>
